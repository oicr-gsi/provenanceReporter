{% extends 'project_base.html' %}


{% block link %}
<a href="{{ url_for('project_page', project_name=project['project_id']) }}">{{ project['project_id'] }}</a>
<a class="selected" href="{{ url_for('sequencing', project_name=project['project_id']) }}">Sequencing</a>
 {% for i in pipelines %}
   {% if i in routes %}
     <a href="{{ url_for(routes[i], project_name=project['project_id']) }}">{{i}}</a>
   {% else %}
     <a href="#{{i}}">{{i}}</a>
   {% endif %}  
  {% endfor %}   
{% endblock %}


{% block content %}
  <div class="project_title">
    <p>{% block title %}{{ project['project_id'] }} {% endblock %}
      {% if sequences %}
        <span style="font-size:30px; font-style:normal;"> Displaying sequence information for <span id ="count"> {{ sequences|length }} </span> records</span>
        <button id="download_button" style="margin-top:20px;margin-left:100px"><a href="{{url_for('download_identifiers_table', project_name=project['project_id'])}}">Download library information</a></button>
      {% else %}
        <span style="font-size:30px; font-style:normal;"> No sequence information to display</span>
      {% endif %}  
    </p>   
  </div> 

      



<div class="dropdown">
  <button class="dropbtn">Select Platform</button>
  <div class="dropdown-content">
           
      <input type="checkbox" id="platform" name="novaseq" value="novaseq" onchange="checkPlatform()" CHECKED>
      <label for="novaseq"> NovaSeq</label><br>
      <input type="checkbox" id="platform" name="hiseq" value="hiseq" CHECKED>
      <label for="hiseq"> HiSeq</label><br>
      <input type="checkbox" id="platform" name="miseq" value= "miseq" CHECKED>
      <label for="miseq"> MiSeq</label><br><br>
      <input type="submit" value="Submit">
      
  </div>
</div>












  {% if sequences %}
  
   <div style="margin-left:auto;margin-right:auto;margin-top:80px;padding-bottom:7px;max-width:300px;position:relative">
     <input type="text" id="search_table"  onkeyup="searchFunction()" placeholder="Search.." title="Type in a keyword">
   </div>

  <table id="project_table">
   <thead>
     <th><div class="tooltip">Case<span class="tooltiptext">OICR-generated case identifier</span></th>
     <th><div class="tooltip">Donor<span class="tooltiptext">User-supplied donor identifier</span></th>
     <th><div class="tooltip">Sample ID<span class="tooltiptext">User-supplied sample, this distinguishes distinct samples of the same type from the same donor</span></th>
     <th><div class="tooltip">Sample<span class="tooltiptext">OICR-generated sample identifier. Formed from: 1. case, 2. tissue origin, 3. tissue type, 4. sample ID</span></th>
     <th><div class="tooltip">Description<span class="tooltiptext">a description of the Sample ID</span></th>
     <th><div class="tooltip">Library<span class="tooltiptext">OICR-generated library identifier</span></th>     
     <th>Library Type</th>     
     <th>Tissue Origin</th>     
     <th>Tissue Type</th>     
     <th><div class="tooltip">Platform<span class="tooltiptext">Sequencing instrument</span></th>
     <th><div class="tooltip">File Prefix<span class="tooltiptext">The common prefix, followed by the sequencing read (R1, R2) and the file suffix .fastq.gz. The file prefix is formed is formed from: 1. Library Id, 2. Run date, 3. Instrument Id, 4. Sequencing Instrument Run, 5.
Flow cell identifier, 6. Lane number, 7. Demultiplex barcodes</span></th>
     <th><div class="tooltip">Read Pairs<span class="tooltiptext">Number of read pairs. The number of reads is twice the number of read pairs</span></th>
     <th>Workflow</th> 
     <th>Release status</th>
   </thead>     

   {% for i in sequences %}
     <tr>
       <td> {{i['case']}} </td>
       <td> {{i['sample']}} </td>
       <td> {{i['group_id']}} </td>
       <td> {{i['sample_id']}} </td>
       <td> {{i['group_description']}} </td>
       <td> {{i['library']}} </td>
       <td> {{i['library_type']}} </td>
       <td> {{i['tissue_origin']}} </td>
       <td> {{i['tissue_type']}} </td>
       <td> {{i['platform']}} </td>
       <td> {{i['prefix']}} </td>        
       <td class='alnright'> {{i['read_count']}} </td>
       <td> {{i['workflow']}} </td>
       {% if i['ticket'] %}
         <td><a class="miso_link" href="{{i['ticket']}}" target="_blank">{{ i['release_status'] }}</a></td>
       {% else %}
         <td> {{i['release_status']}} </td>
       {% endif %}
     </tr>
   {% endfor %}               
   </table>


<footer>
<p style="margin-left:auto;margin-right:auto; margin-top:150px; padding-bottom:0px;max-width:300px;position:relative;font-size:16px; font-style:normal; font-family: Arial, Helvetica, sans-serif; color: #A8A8A8;"> Data last updated {{project['last_updated'].split('_')[0]}} </p>
</footer>


  
   <script>
   function searchFunction() {
   var input, filter, table, tr, td, i, txtValue;
   var rowCount = 0    
   input = document.getElementById("search_table");
   filter = input.value.toUpperCase();
   table = document.getElementById("project_table");
   tr = table.getElementsByTagName("tr");
   for (i = 1; i < tr.length; i++) {
   td= tr[i];
     if (td) {
       txtValue = td.textContent || td.innerText;
       if (txtValue.toUpperCase().indexOf(filter) > -1) {
         tr[i].style.display = "";
         rowCount++;
       } else {
         tr[i].style.display = "none";
         }
     }       
    }
   document.getElementById("count").innerHTML = rowCount
   }


   function checkPlatform(){
    var input, filter, checkbox, table, tr, td, i, textValue;
    var rowCount = 0
    checkbox = document.getElementById('platform');
    filter = checkbox.value.toUpperCase()
    input = document.getElementById("platform");

    table = document.getElementById("project_table");
    tr = table.getElementsByTagName("tr");         
    for (i = 1; i < tr.length; i++) {
    td= tr[i];
     if (td) {
       txtValue = td.textContent || td.innerText;
       if (checkbox.checked != false) {
	    alert("Checkbox checked")
            tr[i].style.display = "";
            rowCount++;                   
            

    }else{
	    alert("Not Checked")
            tr[i].style.display = "none";
    }
  document.getElementById("count").innerHTML = rowCount
  
}
}


  </script>

  {% endif %}


   
{% endblock %}
