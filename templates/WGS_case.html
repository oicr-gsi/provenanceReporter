{% extends 'project_base.html' %}


{% block link %}
 <a href="{{ url_for('project_page', project_name=project['project_id']) }}">{{ project['project_id'] }}</a>
 <a href="{{ url_for('sequencing', project_name=project['project_id']) }}">Sequencing</a> 
 {% for i in pipelines %}
   {% if i in routes %}
     <a href="{{ url_for(routes[i], project_name=project['project_id']) }}">{{i}}</a>
   {% else %}
     <a href="#{{i}}">{{i}}</a>
   {% endif %}  
 {% endfor %}   
 <a class="split" href="{{ miso_link }}" target="_blank">{{ case }}</a> 

{% endblock %}


{% block content %}
  <div class="project_title">
    <p><span style="font-size:30px; font-style:normal;"> Somatic callers analysis blocks </span></p>  
    <p><span style="font-size:16px; font-style:normal;"> Select analysis blocks for each sample pair. An analysis block includes parent call-ready workflows and all downstream caller-workflows.</span></p>  
  </div> 

  {% for pair in sample_pairs_names %}
     <div class="somatic_block">

       <p style="font-size:22px; font-style:bold;"> Samples: {{pair}} </p>
       
       {% for block in ordered_blocks[pair] %}

         <div class="somatic_block">
           <table id="block_header_table">
             <tr>
               <td><span style="font-size:16px; font-style:normal;">{{ names[pair][block] }}</span></td>
               <td>Date: {{block_date[pair][block]}} </td>
               {% if complete[pair][block] %}
                 <td>Complete: <span style="font-size:32px;color:#70db70">&#10004;</span></td>
               {% else %}
                 <td>Complete: <span style="font-size:32px;color:#ff3300;">&#10006;</span></td>
               {% endif %}
               {% if release_status[pair][block] %}
                 <td>Release Status: <span style="font-size:32px;color:#70db70">&#10004;</span></td>
               {% else %}
                 <td>Release Status: <span style="font-size:32px;color:#ff3300;">&#10006;</span></td>
               {% endif %}
                 <td>
                   <button id="download_button"><a href="{{url_for('download_block_data', project_name=project['project_id'], case=case, block=pair, bmpp_parent=block)}}">Download json</a></button>
                 </td>
             </tr>
           </table>
         

              

      <p style="font-size:22px; font-style:bold;"> Call-ready workflows </p>     

       <table id="block_table">
         <thead>
          <th>workflow_run_id</th>
          <th>workflow</th>
          <th>file count</th>
          <th>lane count</th>
          <th>date</th>      
          <th>samples</th>
        </thead>     
        
        {% for bmpp_run in samples_bmpp[pair][block] %}
          <tr>
            <td>{{bmpp_run | shorten_workflow_id}}</td>
            <td>{{samples_bmpp[pair][block][bmpp_run]['name'].0}}</td>
            <td>{{file_counts[bmpp_run]}}</td>
            <td>{{amount_data[pair][block][bmpp_run]}}</td>
            <td>{{workflow_date[pair][block][bmpp_run]}}</td>
            <td>
              <dl>
              {% for i in samples_bmpp[pair][block][bmpp_run]['samples']['normal'] %}
                <dt>{{i}}</dt>
              {% endfor %}
              {% for i in samples_bmpp[pair][block][bmpp_run]['samples']['tumour'] %}
                <dt>{{i}}</dt> 
              {% endfor %}
            </dl>
            </td>
          </tr>
         {% endfor %}
       </table>
     

      

      
      <p style="font-size:22px; font-style:bold;"> Caller workflows </p>

      <table id="block_table">
        <thead>
          <th>workflow_run_id</th>
          <th>workflow</th>
          <th>file count</th>
          <th>lane count</th>
          <th>date</th>     
          <th>platform</th>
        </thead>     
       
       {% for d in blocks[pair][block] %}
         {% for workflow in d %}
           <tr>
             <td>{{d[workflow]['parent']['wfrun_id'] | shorten_workflow_id}}</td>
             <td>{{d[workflow]['parent']['wf']}}</td>
             <td>{{file_counts[d[workflow]['parent']['wfrun_id']]}}</td>              
             <td>{{amount_data[pair][block][d[workflow]['parent']['wfrun_id']]}}</td>             
             <td>{{workflow_date[pair][block][d[workflow]['parent']['wfrun_id']]}}</td>
             <td>{{d[workflow]['parent']['platform']}}</td>     
           </tr>
           {% if d[workflow]['children'] %}
             {% for k in d[workflow]['children'] %}
               <tr>
                 <td>{{k['wfrun_id'] | shorten_workflow_id}}</td>
                 <td>{{k['wf']}}</td>
                 <td>{{file_counts[k['wfrun_id']]}}</td>
                 <td>{{amount_data[pair][block][k['wfrun_id']]}}</td>
                 <td>{{workflow_date[pair][block][k['wfrun_id']]}}</td>          
                 <td>{{k['platform']}}</td>
               </tr>     
             {% endfor %}         
           {% endif %}
         {% endfor %}    
       {% endfor %}
      </table>
       

     <p style="font-size:22px; font-style:bold;"> Workflow relationships: </p>
     <img src="data:image/png;base64,{{figures[pair][block]}}" alt="workflow_network" title="workflows" style="padding-right: 8px; padding-left:8px; width:25%; height:25%"/>
     
     </div>   

     {% endfor %}


  </div> 
  <br>
  <br>

  {% endfor %}
{% endblock %}


