{% extends 'project_base.html' %}


{% block link %}
  <a href="{{ url_for('project_page', project_name=project['project_id']) }}">{{ project['project_id'] }}</a>
  <a href="{{ url_for('sequencing', project_name=project['project_id']) }}">Sequencing</a>
  {% for i in pipelines %}
    {% if i in routes %}
      {% if i == 'Shallow Whole Genome' %}
        <a class="selected" href="{{ url_for(routes[i], project_name=project['project_id']) }}">{{i}}</a>
      {% else %}
        <a href="{{ url_for(routes[i], project_name=project['project_id']) }}">{{i}}</a>   
      {% endif %}  
    {% else %}
        <a href="#{{i}}">{{i}}</a>
    {% endif %}  
  {% endfor %}   
{% endblock %}


{% block content %}
  <div class="project_title">
    <p>{% block title %}{{ project['project_id'] }} {% endblock %}
      {% if swg %}
        <span style="font-size:30px; font-style:normal;"> WGS workflow data for <span id ="count"> {{ swg|length }} </span> cases</span>
        
        <div class="download-dropdown">
          <button class="download-dropbtn">Download json</button>
            <div class="download-dropdown-content">
              <form method="POST" action ="">
                {% if deliverable == 'selected' %}
                  <label><input class="checkbox_small" type="checkbox" name="deliverable" value="selected" id="deliverable" checked/>selected</label><br>      
                {% else %}
                  <label><input class="checkbox_small" type="checkbox" name="deliverable" value="selected" id="deliverable"/>selected</label><br>      
                {% endif %}
                {% if deliverable == 'standard' %}
                  <label><input class="checkbox_small" type="checkbox" name="deliverable" value="standard" id="deliverable" checked/>standard</label><br>      
                {% else %}
                  <label><input class="checkbox_small" type="checkbox" name="deliverable" value="standard" id="deliverable"/>standard</label><br>      
                {% endif %}
                <button class="select_button" type = "submit" value="submit">Download</button>
              </form>          
            </div>
        </div>  
        
      {% else %}
        <span style="font-size:30px; font-style:normal;"> No cases to display</span>
      {% endif %}  
    </p>   
    
  </div> 

  {% if swg %}
  
    <div style="margin-left:auto;margin-right:auto;margin-top:80px;padding-bottom:7px;max-width:300px;position:relative">
      <input type="text" id="search_table"  onkeyup="searchFunction()" placeholder="Search.." title="Type in a keyword">
    </div>

  
  
  <table id="wgs_table">
    <thead>
      <th>Case</th>
      <th>Sample</th>
      <th>Workflow</th>
      <th>Library</th>
      <th>Platform</th>
      <th>Status</th>
    </thead>     

    {% set donors = swg.keys() | list | sort %}
    {% for i in donors %}
      {% set samples = swg[i].keys() | list | sort %}
      {% for j in samples %}
        {% for workflow_id in swg[i][j] %}
          <tr>
            <td>
              {{i}}
            </td>
            <td>
              {{j}}
            </td>  
            <td>
              {{workflow_id | shorten_workflow_id}}
            </td>
            <td>  
              <dl>
                {% for library in swg[i][j][workflow_id]['library'] %}
                  <dt>
                    {{library}}
                  </dt>
                  <br>
                {% endfor %}
              </dl>       
            </td>
            <td>
              {{swg[i][j][workflow_id]['platform']}}
            </td>
            <td>
              <a class="project_links" href="#">
                {% if i in status %}
                  {% if j in status[i] %}
                    {% if status[i][j][workflow_id] != 'review' and status[i][j][workflow_id] != 'ready' %}
                      {{status[i][j][workflow_id] | shorten_workflow_id}}
                    {% else %}
                      <button class="review_button">{{status[i][j][workflow_id]}}</button>
                    {% endif %}
                  {% endif %}
                {% endif %}               
              </a>         
            </td> 
        {% endfor %}
      {% endfor %}    
    {% endfor %}  
  </table>

  <footer>
    <p style="margin-left:auto;margin-right:auto; margin-top:150px; padding-bottom:0px;max-width:300px;position:relative;font-size:16px; font-style:normal; font-family: Arial, Helvetica, sans-serif; color: #A8A8A8;"> Data last updated {{project['last_updated'].split('_')[0]}} </p>
  </footer>
  
  <script>
    function searchFunction() {
      var input, filter, table, tr, td, i, txtValue;
      var rowCount = 0    
      input = document.getElementById("search_table");
      filter = input.value.toUpperCase();
      table = document.getElementById("project_table");
      tr = table.getElementsByTagName("tr");
      for (i = 1; i < tr.length; i++) {
        td= tr[i];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
            rowCount++;
          } else {
            tr[i].style.display = "none";
          }
        }       
      }
      document.getElementById("count").innerHTML = rowCount
    }
  </script>

  {% endif %}
  
{% endblock %}
